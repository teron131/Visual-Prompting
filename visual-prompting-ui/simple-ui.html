<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Prompting Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --primary: 222.2 47.4% 11.2%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96%;
            --secondary-foreground: 222.2 84% 4.9%;
            --muted: 210 40% 96%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --success: 142 76% 36%;
            --success-foreground: 210 40% 98%;
        }

        .dark {
            --background: 0 0% 2%;
            --foreground: 0 0% 98%;
            --card: 0 0% 4%;
            --card-foreground: 0 0% 95%;
            --primary: 0 0% 90%;
            --primary-foreground: 0 0% 10%;
            --secondary: 0 0% 6%;
            --secondary-foreground: 0 0% 90%;
            --muted: 0 0% 8%;
            --muted-foreground: 0 0% 65%;
            --border: 0 0% 10%;
            --input: 0 0% 8%;
            --ring: 0 0% 80%;
            --success: 142 76% 36%;
            --success-foreground: 210 40% 98%;
        }

        .theme-toggle-icon {
            transition: all 0.3s ease;
        }
        
        .theme-toggle-icon.rotate-out {
            transform: rotate(-90deg) scale(0);
        }
        
        .theme-toggle-icon.rotate-in {
            transform: rotate(0deg) scale(1);
        }

        /* Range slider styling for dark mode */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-track {
            background: hsl(var(--muted));
            height: 0.5rem;
            border-radius: 0.25rem;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            background: hsl(var(--primary));
            height: 1.25rem;
            width: 1.25rem;
            border-radius: 50%;
            border: 2px solid hsl(var(--background));
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-track {
            background: hsl(var(--muted));
            height: 0.5rem;
            border-radius: 0.25rem;
            border: none;
        }

        input[type="range"]::-moz-range-thumb {
            background: hsl(var(--primary));
            height: 1.25rem;
            width: 1.25rem;
            border-radius: 50%;
            border: 2px solid hsl(var(--background));
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-background to-secondary min-h-screen transition-all duration-300">
    <div class="container mx-auto px-4 py-8">
        <!-- Header with theme toggle -->
        <div class="flex justify-between items-center mb-8">
            <div class="text-center flex-1">
                <h1 class="text-4xl font-bold text-foreground mb-2">Visual Prompting Studio</h1>
                <p class="text-muted-foreground text-lg">AI-powered structured prompt generation for visual media</p>
            </div>
            <button id="themeToggle" class="flex-shrink-0 relative p-2 rounded-md border border-foreground bg-transparent hover:bg-foreground hover:bg-opacity-10 transition-colors shadow-sm">
                <svg id="sunIcon" class="w-5 h-5 theme-toggle-icon rotate-in text-foreground" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg id="moonIcon" class="w-5 h-5 theme-toggle-icon rotate-out absolute top-2 left-2 text-foreground" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <span class="sr-only">Toggle theme</span>
            </button>
        </div>

        <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Panel -->
            <div class="bg-card text-card-foreground rounded-lg shadow-lg p-6 border border-border">
                <div class="mb-6">
                    <!-- Mode Tabs -->
                    <div class="flex bg-muted rounded-lg p-1 mb-6">
                        <button id="imageTab" class="flex-1 flex items-center justify-center py-2 px-4 rounded-md text-sm font-medium transition-colors bg-background text-foreground shadow-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21,15 16,10 5,21"></polyline>
                            </svg>
                            Image
                        </button>
                        <button id="videoTab" class="flex-1 flex items-center justify-center py-2 px-4 rounded-md text-sm font-medium transition-colors text-muted-foreground hover:text-foreground">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                            </svg>
                            Video
                        </button>
                    </div>

                    <!-- Prompt Type -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-foreground mb-1">Prompt Type</label>
                        <select id="promptType" class="w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring">
                            <option value="standard">Standard</option>
                            <option value="creative">Creative</option>
                            <option value="detailed">Detailed</option>
                            <option value="artistic">Artistic</option>
                            <option value="photorealistic">Photorealistic</option>
                        </select>
                    </div>

                    <!-- Text Input -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-foreground mb-1">Prompt</label>
                        <textarea id="promptText" rows="4" class="w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring" placeholder="Describe what you want to see..."></textarea>
                    </div>

                    <!-- Image Upload -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-foreground mb-2">Reference Image (Optional)</label>
                        <div class="flex items-center gap-2">
                            <label for="imageUpload" class="cursor-pointer inline-flex items-center px-4 py-2 border border-input rounded-md text-sm font-medium text-foreground bg-background hover:bg-secondary">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                Upload Image
                            </label>
                            <input type="file" id="imageUpload" accept="image/*" class="hidden">
                        </div>
                        <div id="imagePreview" class="mt-3 hidden">
                            <div class="relative w-32 h-32 rounded-md overflow-hidden border border-border">
                                <img id="previewImg" src="" alt="Preview" class="w-full h-full object-cover">
                                <button id="removeImage" class="absolute top-1 right-1 bg-background/80 rounded-full p-1 hover:bg-background">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Output Count -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-foreground mb-2">Number of Outputs: <span id="outputCountLabel">1</span></label>
                        <input type="range" id="outputCount" min="1" max="4" value="1" class="w-full">
                        <div class="flex justify-between text-xs text-muted-foreground mt-1">
                            <span>1</span>
                            <span>2</span>
                            <span>3</span>
                            <span>4</span>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <button id="generateBtn" class="w-full bg-primary text-primary-foreground py-2 px-4 rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span id="generateBtnText">Generate Image Prompts</span>
                        <span id="generateSpinner" class="hidden ml-2">
                            <svg class="animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </span>
                    </button>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="bg-card text-card-foreground rounded-lg shadow-lg p-6 border border-border">
                <h2 class="text-xl font-semibold mb-4">Generated Prompts</h2>
                <div id="resultsContainer">
                    <div class="text-center text-muted-foreground py-8">
                        <p class="text-lg mb-2">No prompts generated yet</p>
                        <p class="text-sm">Enter a description and click generate to see your structured prompts</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'image';
        let selectedImage = null;

        // Theme management
        function initTheme() {
            // Check for saved theme preference or default to system preference
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
                document.documentElement.classList.add('dark');
                updateThemeIcons(true);
            } else {
                document.documentElement.classList.remove('dark');
                updateThemeIcons(false);
            }
        }

        function updateThemeIcons(isDark) {
            const sunIcon = document.getElementById('sunIcon');
            const moonIcon = document.getElementById('moonIcon');
            
            if (isDark) {
                sunIcon.classList.remove('rotate-in');
                sunIcon.classList.add('rotate-out');
                moonIcon.classList.remove('rotate-out');
                moonIcon.classList.add('rotate-in');
            } else {
                sunIcon.classList.remove('rotate-out');
                sunIcon.classList.add('rotate-in');
                moonIcon.classList.remove('rotate-in');
                moonIcon.classList.add('rotate-out');
            }
        }

        function toggleTheme() {
            const isDark = document.documentElement.classList.contains('dark');
            
            if (isDark) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                updateThemeIcons(false);
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                updateThemeIcons(true);
            }
        }

        // Initialize theme on page load
        initTheme();

        // Theme toggle event listener
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        // Tab switching
        document.getElementById('imageTab').addEventListener('click', () => {
            currentMode = 'image';
            document.getElementById('imageTab').className = "flex-1 flex items-center justify-center py-2 px-4 rounded-md text-sm font-medium transition-colors bg-background text-foreground shadow-sm";
            document.getElementById('videoTab').className = "flex-1 flex items-center justify-center py-2 px-4 rounded-md text-sm font-medium transition-colors text-muted-foreground hover:text-foreground";
            document.getElementById('generateBtnText').textContent = 'Generate Image Prompts';
            document.getElementById('promptText').placeholder = 'Describe what you want to see...';
        });

        document.getElementById('videoTab').addEventListener('click', () => {
            currentMode = 'video';
            document.getElementById('videoTab').className = "flex-1 flex items-center justify-center py-2 px-4 rounded-md text-sm font-medium transition-colors bg-background text-foreground shadow-sm";
            document.getElementById('imageTab').className = "flex-1 flex items-center justify-center py-2 px-4 rounded-md text-sm font-medium transition-colors text-muted-foreground hover:text-foreground";
            document.getElementById('generateBtnText').textContent = 'Generate Video Prompts';
            document.getElementById('promptText').placeholder = 'Describe what you want to watch...';
        });

        // Output count slider
        document.getElementById('outputCount').addEventListener('input', (e) => {
            document.getElementById('outputCountLabel').textContent = e.target.value;
        });

        // Image upload
        document.getElementById('imageUpload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                selectedImage = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // Remove image
        document.getElementById('removeImage').addEventListener('click', () => {
            selectedImage = null;
            document.getElementById('imageUpload').value = '';
            document.getElementById('imagePreview').classList.add('hidden');
        });

        // Generate prompts
        document.getElementById('generateBtn').addEventListener('click', async () => {
            const promptText = document.getElementById('promptText').value.trim();
            if (!promptText) return;

            const generateBtn = document.getElementById('generateBtn');
            const generateBtnText = document.getElementById('generateBtnText');
            const generateSpinner = document.getElementById('generateSpinner');
            const outputCount = document.getElementById('outputCount').value;

            // Show loading state
            generateBtn.disabled = true;
            generateBtnText.textContent = 'Generating...';
            generateSpinner.classList.remove('hidden');

            try {
                let response;
                if (selectedImage) {
                    // With image
                    const formData = new FormData();
                    formData.append('mode', currentMode);
                    formData.append('num_outputs', outputCount);
                    formData.append('text_input', promptText);
                    formData.append('image', selectedImage);

                    response = await fetch('/api/generate-with-image', {
                        method: 'POST',
                        body: formData
                    });
                } else {
                    // Without image
                    response = await fetch('/api/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            mode: currentMode,
                            text_input: promptText,
                            num_outputs: parseInt(outputCount)
                        })
                    });
                }

                if (response.ok) {
                    const data = await response.json();
                    displayResults(data.prompts, data.mode);
                } else {
                    const errorData = await response.json().catch(() => ({ detail: 'Unknown error occurred' }));
                    showError(`Generation failed: ${errorData.detail || 'Please try again.'}`);
                }
            } catch (error) {
                showError('Network error occurred. Please check your connection and try again.');
            } finally {
                // Reset button state
                generateBtn.disabled = false;
                generateBtnText.textContent = `Generate ${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)} Prompts`;
                generateSpinner.classList.add('hidden');
            }
        });

        function showError(message) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = `
                <div class="text-center text-muted-foreground py-8">
                    <p class="text-lg mb-2 text-red-500">⚠️ Error</p>
                    <p class="text-sm">${message}</p>
                </div>
            `;
        }

        function displayResults(prompts, mode) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';

            prompts.forEach((prompt, index) => {
                const promptCard = document.createElement('div');
                promptCard.className = 'border border-border bg-card text-card-foreground rounded-md p-4 mb-4 shadow-sm';
                promptCard.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-muted-foreground capitalize">${mode} Prompt ${prompts.length > 1 ? `#${index + 1}` : ''}</span>
                        <button onclick="copyToClipboard('${prompt.replace(/'/g, "\\'")}', this)" class="text-sm px-3 py-1 border border-border bg-background text-foreground rounded-md hover:bg-secondary transition-colors">
                            Copy
                        </button>
                    </div>
                    <p class="text-sm text-foreground whitespace-pre-wrap leading-relaxed">${prompt}</p>
                `;
                container.appendChild(promptCard);
            });
        }

        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.className = 'text-sm px-3 py-1 border border-border bg-success text-success-foreground rounded-md transition-colors';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.className = 'text-sm px-3 py-1 border border-border bg-background text-foreground rounded-md hover:bg-secondary transition-colors';
                }, 2000);
            }).catch(() => {
                // Fallback for browsers that don't support clipboard API
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.className = 'text-sm px-3 py-1 border border-border bg-success text-success-foreground rounded-md transition-colors';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.className = 'text-sm px-3 py-1 border border-border bg-background text-foreground rounded-md hover:bg-secondary transition-colors';
                }, 2000);
            });
        }

        // Enable generate button when text is entered
        document.getElementById('promptText').addEventListener('input', (e) => {
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = !e.target.value.trim();
        });
    </script>
</body>
</html> 